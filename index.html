<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AI Cyber Terminal</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .terminal { width: 90%; max-width: 600px; height: 80vh; border: 1px solid #0f0; display: flex; flex-direction: column; padding: 20px; box-shadow: 0 0 15px #0f0; }
        #output { flex: 1; overflow-y: auto; margin-bottom: 20px; white-space: pre-wrap; font-size: 14px; }
        .input-line { display: flex; gap: 10px; }
        input { flex: 1; background: #000; border: 1px solid #0f0; color: #0f0; padding: 10px; outline: none; }
        button { background: #0f0; border: none; color: #000; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #050; color: #0a0; }
        .ai-reply { color: #fff; background: #111; padding: 10px; margin: 5px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="terminal">
        <div id="output">*** СИСТЕМА ГОТОВА. ШЛЮЗ GOOGLE ОБНАРУЖЕН. ***</div>
        <div class="input-line">
            <input type="text" id="userInput" placeholder="Введите сообщение..." autocomplete="off">
            <button id="sendBtn">ПУСК</button>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        const input = document.getElementById('userInput');
        const btn = document.getElementById('sendBtn');

        // Твоя ссылка уже здесь
        const gateUrl = "https://script.google.com/macros/s/AKfycbzPnpS73g2NATQM5WhYb2K34Rbb3wd1_2yOSEPH8vO-PVlrBa6DcD-jvKgN2oJe6kZukA/exec";

        async function talk() {
            const text = input.value.trim();
            if (!text) return;

            output.innerHTML += `<div>> ${text}</div>`;
            input.value = "";
            btn.disabled = true;
            btn.innerText = "СВЯЗЬ...";

            try {
                // Используем Content-Type: text/plain, чтобы обойти CORS блокировку браузера
                const response = await fetch(gateUrl, {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({ inputs: text })
                });

                const data = await response.json();
                
                if (data.error) {
                    output.innerHTML += `<div style="color:yellow">ИИ еще грузится. Попробуйте снова через 15 секунд.</div>`;
                } else {
                    let answer = Array.isArray(data) ? data[0].generated_text : data.generated_text;
                    // Убираем повтор вопроса из ответа
                    const cleanAnswer = answer.replace(text, "").trim();
                    output.innerHTML += `<div class="ai-reply">${cleanAnswer || "Хм, ИИ прислал пустой ответ..."}</div>`;
                }
            } catch (e) {
                output.innerHTML += `<div style="color:red">СЕРВЕРНАЯ ОШИБКА: Скорее всего, ваш браузер блокирует внешние запросы. Попробуйте открыть сайт в режиме Инкогнито или через другой браузер.</div>`;
            }

            btn.disabled = false;
            btn.innerText = "ПУСК";
            output.scrollTop = output.scrollHeight;
        }

        btn.onclick = talk;
        input.onkeydown = (e) => { if (e.key === 'Enter') talk(); };
    </script>
</body>
</html>
