const googleUrl = "https://script.google.com/macros/s/AKfycbygPlOK2H0gFgLJewnCYKcDtwhClnmH5tJsauH1VrUl5qwCEBgCwlq41LULy0rGKBMzkg/exec";

    async function send() {
        const val = document.getElementById('inp').value.trim();
        if(!val) return;
        
        const chat = document.getElementById('chat');
        chat.innerHTML += `<div>> ${val}</div>`;
        document.getElementById('btn').disabled = true;

        try {
            const response = await fetch(`${googleUrl}?inputs=${encodeURIComponent(val)}`);
            const rawText = await response.text();
            
            console.log("Raw Response:", rawText);

            if (rawText.trim() === "Not Found") {
                chat.innerHTML += `<div style="color:orange">Система: Google вернул 'Not Found'. Проверь, что в настройках Deploy выбрано 'Anyone'.</div>`;
            } else {
                let data = JSON.parse(rawText);
                let resText = Array.isArray(data) ? data[0].generated_text : (data.generated_text || rawText);
                chat.innerHTML += `<div class="ai">${resText.replace(val, "").trim()}</div>`;
            }
        } catch (e) {
            chat.innerHTML += `<div style="color:red">Ошибка парсинга. Ответ сервера: ${e.message}</div>`;
        }

        document.getElementById('btn').disabled = false;
        chat.scrollTop = chat.scrollHeight;
    }
